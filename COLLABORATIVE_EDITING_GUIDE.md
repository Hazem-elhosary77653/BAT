# ๐ฏ ูุธุงู ุงูุชุนุงูู ุงููุชูุฏู - Advanced Collaboration System

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุชุทููุฑ ูุธุงู ุชุนุงูู ูุชูุฏู ูุณูุญ ูุนุฏุฉ ูุณุชุฎุฏููู ุจุงูุนูู ุนูู ููุณ ุงููุซููุฉ ุจุดูู ูุชุฒุงูู ูุน ุฏุนู:
- โ ุชุญุฏูุฏ ุงููุต (Text Selection)
- โ ุชูููู ูุชูุถูุญ (Highlighting)
- โ ุงูุฅุดุงุฑุฉ ูููุณุชุฎุฏููู (Mentions)
- โ ุฅุนุงุฏุฉ ุงูุชูููุฏ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู (AI Regeneration)
- โ ุงููุดุงุฑูุฉ ุงูููุฑูุฉ (Real-time Sharing)

---

## ๐ ุงูููููุงุช ุงูุฌุฏูุฏุฉ

### 1. **SelectionToolbar.jsx**
ูุธูุฑ ุนูุฏ ุชุญุฏูุฏ ุงููุต ูุจุงุดุฑุฉ

**ุงููููุฒุงุช:**
- ููุชูู ุงูุฃููุงู ููุชูููู (5 ุฃููุงู)
- ูุงุฆูุฉ ุงููุณุชุฎุฏููู ุงููุดุทูู ููุฅุดุงุฑุฉ
- ุฒุฑ ุฅุนุงุฏุฉ ุงูุชูููุฏ ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
- ุฒุฑ ูุณุฎ ุงููุต
- ููุถุน ุงูู toolbar ููู ุงูุชุญุฏูุฏ ูุจุงุดุฑุฉ

**ุงูุงุณุชุฎุฏุงู:**
```jsx
<SelectionToolbar
  selection="ุงููุต ุงููุฎุชุงุฑ"
  position={{ top: 100, left: 200 }}
  onHighlight={(color) => { /* ูุนุงูุฌ ุงูุชูููู */ }}
  onMention={(user) => { /* ูุนุงูุฌ ุงูุฅุดุงุฑุฉ */ }}
  onAIRegenerate={() => { /* ูุนุงูุฌ ุฅุนุงุฏุฉ ุงูุชูููุฏ */ }}
  onClose={() => { /* ุฅุบูุงู */ }}
  activeUsers={[{ id: '1', name: 'ุฃุญูุฏ' }]}
/>
```

---

### 2. **AIRegeneratePanel.jsx**
ููุญุฉ ูุชูุฏูุฉ ูุฅุนุงุฏุฉ ุชูููุฏ ุงููุต ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู

**ุงููููุฒุงุช:**
- ุชุนูููุงุช ูุฎุตุตุฉ ููุฐูุงุก ุงูุงุตุทูุงุนู
- ุงูุชุฑุงุญุงุช ุณุฑูุนุฉ (5 ุฎูุงุฑุงุช ุฌุงูุฒุฉ)
- ูุนุงููุฉ ุงููุชูุฌุฉ ูุจู ุงููุจูู
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

**ุงูุงุณุชุฎุฏุงู:**
```jsx
<AIRegeneratePanel
  selection="ุงููุต ุงููุฎุชุงุฑ"
  onReplace={(newText) => { /* ุงุณุชุจุฏุงู ุงููุต */ }}
  onClose={() => { /* ุฅุบูุงู */ }}
/>
```

---

### 3. **HighlightedContent.jsx**
ูุนุฑุถ ุงููุญุชูู ูุน ูู ุงูุชููููุงุช ูุงูุฅุดุงุฑุงุช

**ุงููููุฒุงุช:**
- ุนุฑุถ ุงููุญุชูู ุจุงูุชููููุงุช
- ูุงุฆูุฉ ุจุฌููุน ุงูุชููููุงุช ุงููุดุทุฉ
- ูุนูููุงุช ุงููุณุชุฎุฏู ุงูุฐู ุฃุถุงู ุงูุชูููู
- ุฅุฒุงูุฉ ุงูุชููููุงุช ุจุณูููุฉ
- Hover effects ูููุนูููุงุช ุงูุฅุถุงููุฉ

**ุงูุงุณุชุฎุฏุงู:**
```jsx
<HighlightedContent
  content="ูุญุชูู ุงููุซููุฉ"
  highlights={new Map([
    ['hl-1', { id: 'hl-1', text: 'ูุต', color: 'yellow', createdBy: 'user1' }]
  ])}
  mentions={[]}
  onRemoveHighlight={(id) => {}}
  onRemoveMention={(id) => {}}
  getUserName={(userId) => 'ุงุณู ุงููุณุชุฎุฏู'}
/>
```

---

### 4. **CollaborativeTextEditor.jsx**
ุงููููู ุงูุฑุฆูุณู ุงูุฐู ูุฌูุน ูู ุดูุก

**ุงููููุฒุงุช:**
- ุชูุงูู ูุงูู ูุน ูู ุงูููููุงุช
- ุฅุฏุงุฑุฉ ุญุงูุฉ ุงูุชุนุงูู ุงูููุฑู
- ูุนุงูุฌุฉ ุฃุญุฏุงุซ ุงูุงุฎุชูุงุฑ ูุงูุชุนุฏูู
- ุชุญุฏูุซ ุงููุญุชูู ุงูููุฑู

**ุงูุงุณุชุฎุฏุงู:**
```jsx
<CollaborativeTextEditor
  brdId="brd-123"
  userId="user-456"
  userName="ุฃุญูุฏ ูุญูุฏ"
  content="ูุญุชูู ุงูุจุฑุฏ"
  onContentChange={(newContent) => { /* ุญูุธ */ }}
  section={{ id: 'section-1' }}
/>
```

---

## ๐ช Hooks ุงูุฌุฏูุฏุฉ

### **useTextSelection.js**
ูุฏูุฑ ุชุญุฏูุฏ ุงููุต ูุงููุงููุงูุชุงุช ุงููุญููุฉ

**ุงููุธุงุฆู:**
```javascript
const {
  selection,          // ุงููุต ุงููุฎุชุงุฑ
  toolbarPosition,   // ููุถุน ุงูู toolbar
  highlights,        // Map ูู ุงููุงููุงูุชุงุช
  mentions,          // ูุงุฆูุฉ ุงูุฅุดุงุฑุงุช
  addHighlight,      // ุฅุถุงูุฉ ุชูููู
  removeHighlight,   // ุฅุฒุงูุฉ ุชูููู
  addMention,        // ุฅุถุงูุฉ ุฅุดุงุฑุฉ
  markMentionAsRead, // ุชุนููู ูููุฑูุก
  closeToolbar       // ุฅุบูุงู ุงูู toolbar
} = useTextSelection(contentRef, userId);
```

---

### ุชุญุฏูุซุงุช **useCollaboration.js**
ุชูุช ุฅุถุงูุฉ ูุธุงุฆู ุฌุฏูุฏุฉ ููุชุนุงูู ุงูููุฑู

**ุงููุธุงุฆู ุงูุฌุฏูุฏุฉ:**
```javascript
const {
  highlights,                    // ุงููุงููุงูุชุงุช ุงููุดุชุฑูุฉ
  userSelections,               // ุชุญุฏูุฏุงุช ุงููุณุชุฎุฏููู ุงููุดุทุฉ
  broadcastHighlight,           // ุฅุฑุณุงู ุชูููู ููู ุงููุณุชุฎุฏููู
  removeHighlightBroadcast,    // ุฅุฒุงูุฉ ุชูููู ูุดุชุฑู
  broadcastSelection            // ุฅุฑุณุงู ุงูุชุญุฏูุฏ ุงูุญุงูู
  // ... ุงููุธุงุฆู ุงูุฃุฎุฑู ุงูููุฌูุฏุฉ
} = useCollaboration(brdId, userId, userName);
```

---

## ๐ WebSocket Events

### ูู Client ุฅูู Server:

**ุฅุถุงูุฉ ุชูููู:**
```javascript
socket.emit('add-highlight', {
  brdId,
  highlightId,
  text,
  color,           // 'yellow', 'green', 'blue', 'pink', 'purple'
  createdBy,
  mentionedUser,   // ุงุฎุชูุงุฑู
  timestamp
});
```

**ุฅุฒุงูุฉ ุชูููู:**
```javascript
socket.emit('remove-highlight', {
  brdId,
  highlightId
});
```

**ุฅุฑุณุงู ุงูุชุญุฏูุฏ:**
```javascript
socket.emit('user-selection', {
  brdId,
  userId,
  userName,
  selection: {
    text,
    startOffset,
    endOffset,
    timestamp
  }
});
```

---

### ูู Server ุฅูู Client:

**ุชูููู ุชูุช ุฅุถุงูุชู:**
```javascript
newSocket.on('highlight-added', (data) => {
  // data = { highlightId, text, color, createdBy, ... }
});
```

**ุชูููู ุชูุช ุฅุฒุงูุชู:**
```javascript
newSocket.on('highlight-removed', (data) => {
  // data = { highlightId }
});
```

**ุชุญุฏูุฏ ูู ูุณุชุฎุฏู ุขุฎุฑ:**
```javascript
newSocket.on('user-selection', (data) => {
  // data = { userId, userName, selection: { text, ... } }
});
```

---

## ๐จ ุงูุฃููุงู ุงููุชุงุญุฉ

| ุงูููู | ุงูููุฏ | ุงูุงุณุชุฎุฏุงู |
|------|------|----------|
| ๐จ ุฃุตูุฑ | `yellow` | ุงูุนุงู - ุงูุฅุดุงุฑุงุช ุงูุนุงูุฉ |
| ๐ฉ ุฃุฎุถุฑ | `green` | ุงููุดุงูู ุงููุญูููุฉ - ุงูููุงููุงุช |
| ๐ฆ ุฃุฒุฑู | `blue` | ุงูุฃุณุฆูุฉ - ุงูููุงุญุธุงุช ุงููููุฉ |
| ๐ฅ ูุฑุฏู | `pink` | ุงูุชุญุฐูุฑุงุช - ุงูููุงุท ุงูุญุณุงุณุฉ |
| ๐ช ุจููุณุฌู | `purple` | ุงูุฃููุงุฑ - ุงูุงูุชุฑุงุญุงุช |

---

## ๐ก ุชุฏูู ุงูุนูู

### 1. ุงููุณุชุฎุฏู ูุญุฏุฏ ูุต
```
ุชุญุฏูุฏ ุงููุต
    โ
ุธููุฑ SelectionToolbar
    โ
ุจุซ ุงูุชุญุฏูุฏ ูููุณุชุฎุฏููู ุงูุขุฎุฑูู (broadcastSelection)
```

### 2. ุงููุณุชุฎุฏู ูุฎุชุงุฑ ููู
```
ุงุฎุชูุงุฑ ุงูููู
    โ
ุชูููู ุงููุต ูุญููุงู (addHighlight)
    โ
ุจุซ ุงูุชูููู ููู ุงููุณุชุฎุฏููู (broadcastHighlight)
    โ
ุชุญุฏูุซ HighlightedContent
    โ
ุฅุบูุงู ุงูู toolbar
```

### 3. ุงููุณุชุฎุฏู ูุดูุฑ ูุดุฎุต
```
ุงุฎุชูุงุฑ ูุณุชุฎุฏู ูู ุงููุงุฆูุฉ
    โ
ุฅุถุงูุฉ mention (addMention)
    โ
ุจุซ ูุน ุงูุชูููู ุงูุฃุตูุฑ
    โ
ุฅุดุนุงุฑ ูููุณุชุฎุฏู ุงูููุดุงุฑ ุฅููู
```

### 4. ุงููุณุชุฎุฏู ูุนูุฏ ุชูููุฏ
```
ุงูุถุบุท ุนูู ุฒุฑ ุงูุฐูุงุก ุงูุงุตุทูุงุนู
    โ
ูุชุญ AIRegeneratePanel
    โ
ุฅุฏุฎุงู ุงูุชุนูููุงุช
    โ
ุงุณุชุฏุนุงุก /brd/regenerate-section
    โ
ุนุฑุถ ุงููุชูุฌุฉ
    โ
ุงุณุชุจุฏุงู ุงููุต
    โ
ุชุญุฏูุซ ุฌููุน ุงููุณุชุฎุฏููู
```

---

## ๐ ุงูุฃูุงู ูุงูุตูุงุญูุงุช

โ **ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:**
- ูุฌุจ ุฃู ูููู ุงููุณุชุฎุฏู ุนุถูุงู ูู ุงูุจุฑุฏ
- ูุฌุจ ุฃู ูููู ูู ุตูุงุญูุฉ ุงูุชุนุฏูู
- ุงูุชููููุงุช ุชูุญูุธ ูุน ูุนุฑูู ุงููุณุชุฎุฏู

โ **ุงูุญูุงูุฉ ูู ุงููุณุฎ:**
- ูู ุชูููู ูู ID ูุฑูุฏ
- ูุง ูููู ุชุนุฏูู ุชูููู ุขุฎุฑ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงุฎุชูุงุฑูุฉ)

### 1. **ุชุฎุฒูู ุฏุงุฆู ูููุงููุงูุชุงุช**
```javascript
// ุญูุธ ุงููุงููุงูุชุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
POST /api/brd/:brdId/highlights
```

### 2. **ุณุฌู ุงูุชุญุฏูุซุงุช (Audit Log)**
```javascript
// ุชุณุฌูู ูู ุงูุชุนุฏููุงุช ูุงูุชููููุงุช
POST /api/brd/:brdId/audit-log
```

### 3. **ุงูููุงุฑูุฉ ุจูู ุงูุฅุตุฏุงุฑุงุช (Diff View)**
```javascript
// ุนุฑุถ ุงููุฑููุงุช ุจูู ุงูุฅุตุฏุงุฑุงุช ุงููุฎุชููุฉ
GET /api/brd/:brdId/versions/:versionId/diff
```

### 4. **ุงูุชุนูููุงุช ุงููุชุนููุฉ (Thread Comments)**
```javascript
// ุฅุถุงูุฉ ููุงุด ุญูู ูู ุชูููู
POST /api/highlights/:highlightId/comments
```

---

## ๐งช ุฃูุซูุฉ ุนูููุฉ

### ูุซุงู 1: ุงุณุชุฎุฏุงู ุงููุญุฑุฑ ุงูุชุนุงููู ุงููุงูู
```jsx
import CollaborativeTextEditor from '@/components/CollaborativeTextEditor';

export default function DocumentEditor() {
  const [content, setContent] = useState('ูุญุชูู ุงููุซููุฉ');

  return (
    <CollaborativeTextEditor
      brdId="brd-12345"
      userId="user-67890"
      userName="ุฃุญูุฏ ูุญูุฏ"
      content={content}
      onContentChange={setContent}
      section={{ id: 'section-intro' }}
    />
  );
}
```

### ูุซุงู 2: ุงุณุชุฎุฏุงู SelectionToolbar ูุจุงุดุฑุฉ
```jsx
const [selection, setSelection] = useState('');
const [toolbarPos, setToolbarPos] = useState(null);

return (
  <>
    <div onMouseUp={handleSelection}>
      {content}
    </div>
    <SelectionToolbar
      selection={selection}
      position={toolbarPos}
      onHighlight={(color) => console.log('Color:', color)}
      onMention={(user) => console.log('Mention:', user)}
      activeUsers={activeUsers}
    />
  </>
);
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

| ุงููุดููุฉ | ุงูุณุจุจ | ุงูุญู |
|--------|------|------|
| ุงูู toolbar ูุง ูุธูุฑ | ุชุญุฏูุฏ ุตูุฑ ุฃู ุฎุงุฑุฌ ุงูุนูุตุฑ | ุชุฃูุฏ ูู `contentRef` |
| ุงููุงููุงูุชุงุช ูุง ุชูุดุงุฑู | WebSocket ููุทูุน | ุชุญูู ูู ุงูุงุชุตุงู |
| ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุง ูุฑุฏ | ููุชุงุญ OpenAI ุบูุฑ ุตุญูุญ | ุชุญูู ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ |

---

## ๐ ุงูุฏุนู
ูููุณุงุนุฏุฉ ุฃู ุงูุฃุณุฆูุฉ ุนู ูุฐุง ุงููุธุงูุ ูุฑุฌู ุงูุชูุงุตู ูุน ูุฑูู ุงูุชุทููุฑ.
