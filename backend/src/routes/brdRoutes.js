/**
 * BRD Generation Routes




























































































































































































































































































































































































































































































































































































































Ù„Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø£Ùˆ Ù…Ø´Ø§ÙƒÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ ÙØ±ÙŠÙ‚ Ø§Ù„ØªØ·ÙˆÙŠØ±! ğŸš€- âœ… ØªÙˆØ«ÙŠÙ‚ Ø´Ø§Ù…Ù„- âœ… Ø£Ù…Ø§Ù† Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©- âœ… Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªÙ‚Ø¯Ù…- âœ… ØªØ¹Ø§ÙˆÙ† ÙÙˆØ±ÙŠ ÙˆÙØ¹Ù‘Ø§Ù„- âœ… ÙˆØ§Ø¬Ù‡Ø© Ø³Ù‡Ù„Ø© ÙˆØ³Ø±ÙŠØ¹Ø©ØªÙ… Ø¨Ù†Ø§Ø¡ Ù†Ø¸Ø§Ù… ØªØ¹Ø§ÙˆÙ† Ù…ØªÙ‚Ø¯Ù… ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ†:## Ø§Ù„Ø®Ù„Ø§ØµØ©---   - Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„   - Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙØ§Ø´Ù„Ø© ØªÙØ³Ø¬Ù„   - Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ØªÙØ±Ø¬Ø¹ Ø±Ø³Ø§Ø¦Ù„ ÙˆØ§Ø¶Ø­Ø©4. **Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡**   - Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø· ÙŠÙØ­ÙØ¸ Ù„ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ©   - Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ ØªÙ„ÙˆÙŠÙ† Ù…Ù† Ø´Ø®Øµ Ø¢Ø®Ø±   - ÙƒÙ„ ØªÙ„ÙˆÙŠÙ† ÙŠÙØ­ÙØ¸ Ù…Ø¹ Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…3. **Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**   - Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ù…Ù„ highlight Ù„Ù‚Ø³Ù… Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡   - ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„   - ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ø¹Ø¶ÙˆØ§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø±Ø¯2. **Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª (Authorization)**   - ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‡ÙˆÙŠØªÙƒ Ù‚Ø¨Ù„ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ©   - Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ endpoints ØªØªØ·Ù„Ø¨ token ØµØ­ÙŠØ­1. **Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ù† (Authentication)**### âœ… ÙØ­ÙˆØµØ§Øª Ø§Ù„Ø£Ù…Ø§Ù†:## Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª---```}  );    </div>      />        activeUsers={activeUsers}        onClose={closeToolbar}        onHighlight={handleHighlight}        position={toolbarPosition}        selection={selection}      <SelectionToolbar      </div>        {content}      >        style={{ minHeight: '400px' }}        className="p-6 border rounded-lg bg-white"        ref={contentRef}      <div    <div>  return (  };    closeToolbar();    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ toolbar        broadcastHighlight(selection, color);    // Ø¨Ø« Ù„Ù„Ø¢Ø®Ø±ÙŠÙ†        addHighlight(selection, color);    // Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ù„ÙŠÙ‹Ø§  const handleHighlight = (color) => {  } = useCollaboration(brdId, userId, userName);    highlights: sharedHighlights    broadcastHighlight,    activeUsers,  const {  } = useTextSelection(contentRef, userId);    closeToolbar    removeHighlight,    addHighlight,    highlights,    toolbarPosition,    selection,  const {  const [content, setContent] = useState('Ù…Ø­ØªÙˆÙ‰ Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ­Ø¯ÙŠØ¯');  const contentRef = useRef(null);export default function CustomEditor({ brdId, userId, userName }) {import SelectionToolbar from '@/components/SelectionToolbar';import useCollaboration from '@/hooks/useCollaboration';import useTextSelection from '@/hooks/useTextSelection';import React, { useRef, useState } from 'react';'use client';```jsx### Ù…Ø«Ø§Ù„ 2: Ø§Ø³ØªØ®Ø¯Ø§Ù… Hooks Ù…Ù†ÙØµÙ„Ø©---```}  );    </div>      />        section={{ id: sectionId }}        onContentChange={handleContentChange}        content={content}        userName={userName}        userId={userId}        brdId={brdId}      <CollaborativeTextEditor      </div>        )}          </span>            Ø¢Ø®Ø± Ø­ÙØ¸: {lastSaved.toLocaleTimeString('ar-SA')}          <span className="text-sm text-gray-500">        {lastSaved && (        <h1 className="text-2xl font-bold">Ù…Ø­Ø±Ø± Ø§Ù„Ø¨Ø±Ø¯ Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠ</h1>      <div className="mb-4 flex items-center justify-between">    <div className="p-6">  return (  };    }      console.error('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸:', err);    } catch (err) {      setLastSaved(new Date());      });        content: newContent      await api.put(`/api/brd/${brdId}/section/${sectionId}`, {    try {    // Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª        setContent(newContent);  const handleContentChange = async (newContent) => {  const [lastSaved, setLastSaved] = useState(null);  const [content, setContent] = useState('Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø±Ø¯ Ø§Ù„Ø£ÙˆÙ„ÙŠ');export default function BRDEditor({ brdId, sectionId, userId, userName }) {import CollaborativeTextEditor from '@/components/CollaborativeTextEditor';import React, { useState } from 'react';'use client';```jsx### Ù…Ø«Ø§Ù„ 1: Ø§Ù„Ù…Ø­Ø±Ø± Ø§Ù„ØªØ¹Ø§ÙˆÙ†ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„## Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ©---```}  }    "rewritten": "Ø§Ù„Ù†Øµ Ø§Ù„Ù…ÙØ¹Ø¯Ù‘Ù„"    "original": "Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ",  "data": {  "success": true,{```json**Response:**```}  "context": "Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ" // Ø§Ø®ØªÙŠØ§Ø±ÙŠ  "instruction": "ØµØ­Ø­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¥Ù…Ù„Ø§Ø¦ÙŠØ©",  "selection": "Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø®ØªØ§Ø±",{```json**Body:**```POST /api/brd/smart-edit```bash### 2. Smart Edit---```}  }    "tokensUsed": 150    "timestamp": "2024-02-05T10:30:00Z",    "instruction": "Ø§Ø¬Ø¹Ù„Ù‡ Ø£ÙƒØ«Ø± Ø§Ø­ØªØ±Ø§ÙÙŠØ©",    "result": "Ø§Ù„Ù†Øµ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙØ­Ø³Ù‘Ù†",    "original": "Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ",  "data": {  "success": true,{```json**Response:**```}  "context": "Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ" // Ø§Ø®ØªÙŠØ§Ø±ÙŠ  "sectionId": "section-456", // Ø§Ø®ØªÙŠØ§Ø±ÙŠ  "brdId": "brd-123",        // Ø§Ø®ØªÙŠØ§Ø±ÙŠ  "instruction": "Ø§Ø¬Ø¹Ù„Ù‡ Ø£ÙƒØ«Ø± Ø§Ø­ØªØ±Ø§ÙÙŠØ©",  "text": "Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯Ù‡",{```json**Body:**```POST /api/brd/regenerate-section```bash### 1. Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ù‚Ø³Ù…## API Endpoints---```});  });    selection: data.selection    userName: data.userName,    userId: data.userId,  console.log({socket.on('user-selection', (data) => {```javascript#### 3. ØªØ­Ø¯ÙŠØ¯ Ù…Ù† Ù…Ø³ØªØ®Ø¯Ù… Ø¢Ø®Ø±```});  });    highlightId: data.highlightId  console.log({socket.on('highlight-removed', (data) => {```javascript#### 2. ØªÙ„ÙˆÙŠÙ† ØªÙ…Øª Ø¥Ø²Ø§Ù„ØªÙ‡```});  });    timestamp: data.timestamp    mentionedUser: data.mentionedUser,    createdBy: data.createdBy,    color: data.color,    text: data.text,    highlightId: data.highlightId,  console.log({socket.on('highlight-added', (data) => {```javascript#### 1. ØªÙ„ÙˆÙŠÙ† ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡### Ù…Ù† Server Ø¥Ù„Ù‰ Client:---```});  }    timestamp: new Date()    endOffset: 50,    startOffset: 10,    text: 'Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø®ØªØ§Ø±',  selection: {  userName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',  userId: 'user-789',  brdId: 'brd-123',socket.emit('user-selection', {```javascript#### 3. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯```});  highlightId: 'hl-456'  brdId: 'brd-123',socket.emit('remove-highlight', {```javascript#### 2. Ø¥Ø²Ø§Ù„Ø© ØªÙ„ÙˆÙŠÙ†```});  timestamp: new Date()  mentionedUser: null,       // Ø§Ø®ØªÙŠØ§Ø±ÙŠ  createdBy: 'user-789',  color: 'yellow',           // yellow, green, blue, pink, purple  text: 'Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªÙ„ÙˆÙŠÙ†Ù‡',  highlightId: 'hl-456',  brdId: 'brd-123',socket.emit('add-highlight', {```javascript#### 1. Ø¥Ø¶Ø§ÙØ© ØªÙ„ÙˆÙŠÙ†### Ù…Ù† Client Ø¥Ù„Ù‰ Server:## WebSocket Events---```});  endOffset: 5  startOffset: 0,  text: 'Ø§Ù„Ù†Øµ',broadcastSelection({// Ø¨Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠremoveHighlightBroadcast(highlightId);// Ø­Ø°Ù ØªÙ„ÙˆÙŠÙ† Ù…Ø´ØªØ±Ùƒ);  mentionedUser  // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ÙØ´Ø§Ø± Ø¥Ù„ÙŠÙ‡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)  color,         // Ø§Ù„Ù„ÙˆÙ†  text,          // Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªÙ„ÙˆÙŠÙ†Ù‡broadcastHighlight(// Ø¨Ø« ØªÙ„ÙˆÙŠÙ† Ù…Ø´ØªØ±Ùƒ```javascript**Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:**```} = useCollaboration(brdId, userId, userName);  // ... Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø®Ø±Ù‰  broadcastSelection,        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯  removeHighlightBroadcast,  // Ø¥Ø²Ø§Ù„Ø© ØªÙ„ÙˆÙŠÙ† Ù…Ø´ØªØ±Ùƒ  broadcastHighlight,        // Ø¥Ø±Ø³Ø§Ù„ ØªÙ„ÙˆÙŠÙ† Ù…Ø´ØªØ±Ùƒ  userSelections,            // ØªØ­Ø¯ÙŠØ¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†  highlights,                 // Ø§Ù„Ù‡Ø§ÙŠÙ„Ø§ÙŠØªØ§Øª Ø§Ù„Ù…Ø´ØªØ±ÙƒØ©  activity,                   // Ø³Ø¬Ù„ Ø§Ù„Ù†Ø´Ø§Ø·  threads,                    // Ø®ÙŠÙˆØ· Ø§Ù„Ù†Ù‚Ø§Ø´  mentions,                   // Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„Ø©  lockedSections,             // Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ù‚ÙÙˆÙ„Ø©  activeUsers,                // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†  isConnected,                 // Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„const {import useCollaboration from '@/hooks/useCollaboration';```javascriptÙŠØ¯ÙŠØ± Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ø§Ù„ÙÙˆØ±ÙŠ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†.### useCollaboration.js ğŸ¤---```closeToolbar();// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ toolbarmarkMentionAsRead(mentionId);// ØªØ¹Ù„ÙŠÙ… ÙƒÙ…Ù‚Ø±ÙˆØ¡);  { id: 'user1', name: 'Ø£Ø­Ù…Ø¯' }  // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…  text,           // Ø§Ù„Ù†Øµconst mentionId = addMention(// Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø§Ø±Ø©removeHighlight(highlightId);// Ø¥Ø²Ø§Ù„Ø© ØªÙ„ÙˆÙŠÙ†);  mentionedUser   // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ÙØ´Ø§Ø± Ø¥Ù„ÙŠÙ‡ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)  'yellow',       // Ø§Ù„Ù„ÙˆÙ†  text,           // Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªÙ„ÙˆÙŠÙ†Ù‡const highlightId = addHighlight(// Ø¥Ø¶Ø§ÙØ© ØªÙ„ÙˆÙŠÙ†```javascript**Ø§Ù„ÙˆØ¸Ø§Ø¦Ù:**```} = useTextSelection(contentRef, userId);  closeToolbar        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ toolbar  markMentionAsRead,  // ØªØ¹Ù„ÙŠÙ… ÙƒÙ…Ù‚Ø±ÙˆØ¡  addMention,         // Ø¥Ø¶Ø§ÙØ© Ø¥Ø´Ø§Ø±Ø©  removeHighlight,    // Ø¥Ø²Ø§Ù„Ø© ØªÙ„ÙˆÙŠÙ†  addHighlight,       // Ø¥Ø¶Ø§ÙØ© ØªÙ„ÙˆÙŠÙ†  mentions,           // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª  highlights,         // Map Ù…Ù† Ø§Ù„Ù‡Ø§ÙŠÙ„Ø§ÙŠØªØ§Øª  toolbarPosition,    // Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù€ toolbar  selection,           // Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø®ØªØ§Ø±const {import useTextSelection from '@/hooks/useTextSelection';```javascriptÙŠØ¯ÙŠØ± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ù‡Ø§ÙŠÙ„Ø§ÙŠØªØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©.### useTextSelection.js ğŸ¯## Ø§Ù„Ù€ Hooks---| section | object | Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø³Ù… | âŒ || onContentChange | function | Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª | âœ… || content | string | Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù‚Ø³Ù… | âœ… || userName | string | Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… | âœ… || userId | string | Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… | âœ… || brdId | string | Ù…Ø¹Ø±Ù‘Ù Ø§Ù„Ø¨Ø±Ø¯ | âœ… ||------|------|--------|---------|| Prop | Type | Ø§Ù„ÙˆØµÙ | Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠ |**Props:**```/>  section={{ id: 'section-1' }}  onContentChange={(newContent) => saveContent(newContent)}  content="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø±Ø¯"  userName="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯"  userId="user-456"  brdId="brd-123"<CollaborativeTextEditorimport CollaborativeTextEditor from '@/components/CollaborativeTextEditor';```jsxØ§Ù„Ù…ÙƒÙˆÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ø°ÙŠ ÙŠØ¬Ù…Ø¹ ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ø¹Ø§Ù‹.### CollaborativeTextEditor.jsx ğŸ¯---```/>  getUserName={(userId) => 'Ø§Ù„Ø§Ø³Ù…'}  onRemoveMention={(id) => {}}  onRemoveHighlight={(id) => {}}  mentions={[]}  ])}    }]      mentionedUser: null      createdBy: 'user1',      color: 'yellow',      text: 'Ù†Øµ',      id: 'hl-1',    ['hl-1', {  highlights={new Map([  content="Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø©"<HighlightedContentimport HighlightedContent from '@/components/HighlightedContent';```jsxÙŠØ¹Ø±Ø¶ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ„ÙˆÙŠÙ†Ø§Øª ÙˆØ§Ù„Ø¥Ø´Ø§Ø±Ø§Øª.### HighlightedContent.jsx ğŸ“---- Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù†Øµ Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©- Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© ÙÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø©- Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø³Ø±ÙŠØ¹Ø© (5 Ø®ÙŠØ§Ø±Ø§Øª)- Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø­Ø± Ù„Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª**Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:**```/>  onClose={() => console.log('Closed')}  onReplace={(newText) => console.log('New text:', newText)}  selection="Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø®ØªØ§Ø±"<AIRegeneratePanelimport AIRegeneratePanel from '@/components/AIRegeneratePanel';```jsxÙ„ÙˆØ­Ø© Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù†Øµ.### AIRegeneratePanel.jsx ğŸ¤–---| activeUsers | array | Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ† || onClose | function | Ù…Ø¹Ø§Ù„Ø¬ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ || onAIRegenerate | function | Ù…Ø¹Ø§Ù„Ø¬ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ AI || onMention | function | Ù…Ø¹Ø§Ù„Ø¬ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³ØªØ®Ø¯Ù… || onHighlight | function | Ù…Ø¹Ø§Ù„Ø¬ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ù„ÙˆÙ† || position | object | Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù€ toolbar {top, left} || selection | string | Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø®ØªØ§Ø± ||------|------|--------|| Prop | Type | Ø§Ù„ÙˆØµÙ |**Props:**```/>  activeUsers={activeUsers}  onClose={() => console.log('Closed')}  onAIRegenerate={() => console.log('AI Regen')}  onMention={(user) => console.log('Mentioned:', user)}  onHighlight={(color) => console.log('Color:', color)}  position={{ top: 100, left: 200 }}  selection="Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø®ØªØ§Ø±"<SelectionToolbarimport SelectionToolbar from '@/components/SelectionToolbar';```jsxÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©.### SelectionToolbar.jsx âš™ï¸## Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª---- Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù‚Ø¨ÙˆÙ„- Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø³Ø±ÙŠØ¹Ø© Ø¬Ø§Ù‡Ø²Ø©- Ø¥Ø¯Ø®Ø§Ù„ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù…Ø®ØµØµØ©**Ø§Ù„Ø®ØµØ§Ø¦Øµ:**```ğŸ’¼ Ø§Ø¬Ø¹Ù„Ù‡ Ù…Ù†Ø§Ø³Ø¨Ø§Ù‹ Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ù…ÙŠğŸ¯ Ø£Ø¶Ù ØªÙØ§ØµÙŠÙ„ Ø£ÙƒØ«Ø± ÙˆØ¶ÙˆØ­Ø§Ù‹ğŸ“ Ø§Ø¬Ø¹Ù„Ù‡ Ø£ÙƒØ«Ø± Ø§Ø­ØªØ±Ø§ÙÙŠØ©âœï¸ Ø­Ø³Ù‘Ù† Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ ÙˆØ§Ù„ØµÙŠØ§ØºØ©ğŸ‡¸ğŸ‡¦ ØªØ±Ø¬Ù…Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©```**Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©:**### 4ï¸âƒ£ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (AI Regeneration)---- Ø¹Ø¯Ù… ÙÙ‚Ø¯Ø§Ù† Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©- ØªØªØ¨Ø¹ Ù…Ù† ØªÙ… Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø¥Ù„ÙŠÙ‡- Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†**Ø§Ù„ÙØ§Ø¦Ø¯Ø©:**```ÙŠØ¸Ù‡Ø± notification Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… B    â†“ÙŠØ®ØªØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… B    â†“ØªØ¸Ù‡Ø± Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†    â†“ÙŠØ¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Mention    â†“Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… A ÙŠØ­Ø¯Ø¯ Ù†Øµ```**ÙƒÙŠÙ ÙŠØ¹Ù…Ù„:**### 3ï¸âƒ£ Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Mentions)---- Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ø¨Ù†Ù‚Ø±Ø© ÙˆØ§Ø­Ø¯Ø©- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ù…Ù† Ø£Ø¶Ø§Ù Ø§Ù„ØªÙ„ÙˆÙŠÙ†- Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ„ÙˆÙŠÙ†Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©- Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙÙˆØ±ÙŠ Ù„Ù„ØªÙ„ÙˆÙŠÙ†Ø§Øª ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ÙˆÙ† Ù…Ù† picker Ø³Ø±ÙŠØ¹**Ø§Ù„Ø®ØµØ§Ø¦Øµ:**```ğŸŸª Ø¨Ù†ÙØ³Ø¬ÙŠ  (Purple)   - Ø§Ù„Ø£ÙÙƒØ§Ø± ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªğŸŸ¥ ÙˆØ±Ø¯ÙŠ    (Pink)     - Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª ÙˆØ§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø³Ø§Ø³Ø©ğŸŸ¦ Ø£Ø²Ø±Ù‚    (Blue)     - Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©ğŸŸ© Ø£Ø®Ø¶Ø±    (Green)    - Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ù…Ø­Ù„ÙˆÙ„Ø© ÙˆØ§Ù„Ù…ÙˆØ§ÙÙ‚Ø§ØªğŸŸ¨ Ø£ØµÙØ±    (Yellow)   - Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª```**Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…ØªØ§Ø­Ø©:**### 2ï¸âƒ£ ØªÙ„ÙˆÙŠÙ† ÙˆØªÙˆØ¶ÙŠØ­ (Highlighting)---- Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª- ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø³ÙŠØ·Ø© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…- ØªÙØ§Ø¹Ù„ ÙÙˆØ±ÙŠ ÙˆØ³Ø±ÙŠØ¹**Ø§Ù„ÙØ§Ø¦Ø¯Ø©:**- Ø§Ù„Ù€ toolbar ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©- ÙŠØ¸Ù‡Ø± toolbar ØµØºÙŠØ± ÙÙˆÙ‚ Ø§Ù„Ù†Øµ Ù…Ø¨Ø§Ø´Ø±Ø©- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ­Ø¯Ø¯ Ù†Øµ ÙÙŠ Ø§Ù„Ù…Ø­Ø±Ø±**ÙƒÙŠÙ ÙŠØ¹Ù…Ù„:**### 1ï¸âƒ£ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ (Text Selection)## Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©---- Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙÙˆØ±ÙŠØ© (Real-time Sharing) Ø¹Ø¨Ø± WebSocket- Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (AI Regeneration) Ù„Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©- Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Mentions) Ù…Ø¹ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙÙˆØ±ÙŠØ©- ØªÙ„ÙˆÙŠÙ† ÙˆØªÙˆØ¶ÙŠØ­ (Highlighting) Ø¨Ù€ 5 Ø£Ù„ÙˆØ§Ù† Ù…Ø®ØªÙ„ÙØ©- ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ (Text Selection) Ù…Ø¹ Ø¸Ù‡ÙˆØ± toolbar ÙÙˆØ±ÙŠâœ¨ **Ø§Ù„Ù…ÙŠØ²Ø§Øª:**ØªÙ… ØªØ·ÙˆÙŠØ± Ù†Ø¸Ø§Ù… ØªØ¹Ø§ÙˆÙ† Ù…ØªÙ‚Ø¯Ù… ÙŠØ³Ù…Ø­ Ù„Ø¹Ø¯Ø© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„ÙˆØ«ÙŠÙ‚Ø© BRD Ø¨Ø´ÙƒÙ„ Ù…ØªØ²Ø§Ù…Ù† Ù…Ø¹ Ø¯Ø¹Ù…:## Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©---8. [Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª](#Ø§Ù„Ø£Ù…Ø§Ù†-ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª)7. [Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ©](#Ø£Ù…Ø«Ù„Ø©-Ø¹Ù…Ù„ÙŠØ©)6. [API Endpoints](#api-endpoints)5. [WebSocket Events](#websocket-events)4. [Ø§Ù„Ù€ Hooks](#Ø§Ù„Ù€-hooks)3. [Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª](#Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª)2. [Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©](#Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª-Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©)1. [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©](#Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©)## ğŸ“– Ø§Ù„ÙÙ‡Ø±Ø³ * All routes require authentication
 */

const express = require('express');
const router = express.Router();
const { body, param, query } = require('express-validator');
const authMiddleware = require('../middleware/authMiddleware');
const brdController = require('../controllers/brdController');

// Middleware to check authentication
router.use(authMiddleware);

/**
 * GET /api/brd
 * List all BRDs for current user
 */
router.get(
  '/',
  query('skip').optional().isInt({ min: 0 }),
  query('limit').optional().isInt({ min: 1, max: 100 }),
  brdController.listBRDs
);

/**
 * GET /api/brd/:id
 * Get specific BRD by ID
 */
router.get(
  '/:id',
  param('id').isUUID(),
  brdController.getBRD
);

/**
 * POST /api/brd/generate
 * Generate BRD from user stories using AI
 */
router.post(
  '/generate',
  body('story_ids')
    .isArray({ min: 1 })
    .withMessage('At least one story ID is required'),
  body('story_ids.*')
    .custom((value) => {
      const num = parseInt(value, 10);
      return !isNaN(num) && num > 0;
    })
    .withMessage('Invalid story ID format'),
  body('title').optional().isString().trim(),
  body('template')
    .optional()
    .isString()
    .withMessage('Invalid template type'),
  body('tone').optional().isString(),
  body('target_audience').optional().isString(),
  body('options.language').optional().isString(),
  body('options.detailLevel')
    .optional()
    .isIn(['summary', 'standard', 'detailed', 'comprehensive'])
    .withMessage('Invalid detail level'),
  brdController.generateBRD
);

/**
 * PUT /api/brd/:id
 * Update BRD content
 */
router.put(
  '/:id',
  param('id').isUUID(),
  body('content').optional().isString(),
  body('title').optional().isString().trim(),
  brdController.updateBRD
);

/**
 * DELETE /api/brd/:id
 * Delete BRD
 */
router.delete(
  '/:id',
  param('id').isUUID(),
  brdController.deleteBRD
);

/**
 * POST /api/brd/regenerate-section
 * Regenerate a BRD section using AI
 */
router.post(
  '/regenerate-section',
  body('text')
    .notEmpty()
    .withMessage('Text is required')
    .isString(),
  body('instruction')
    .notEmpty()
    .withMessage('Instruction is required')
    .isString(),
  body('brdId').optional().isUUID(),
  body('sectionId').optional().isString(),
  body('context').optional().isString(),
  brdController.regenerateSection
);

/**
 * POST /api/brd/smart-edit
 * Smart edit a text selection
 */
router.post(
  '/smart-edit',
  body('selection')
    .notEmpty()
    .withMessage('Selection is required')
    .isString(),
  body('instruction')
    .notEmpty()
    .withMessage('Instruction is required')
    .isString(),
  body('context').optional().isString(),
  brdController.smartEdit
);

/**
 * GET /api/brd/:id/versions
 * Get version history for BRD
 */
router.get(
  '/:id/versions',
  param('id').isUUID(),
  brdController.getVersionHistory
);

/**
 * POST /api/brd/:id/export-pdf
 * Export BRD to PDF
 */
router.post(
  '/:id/export-pdf',
  param('id').isUUID(),
  brdController.exportPDF
);

/**
 * POST /api/brd/:id/export-docx
 * Export BRD to DOCX
 */
router.post(
  '/:id/export-docx',
  param('id').isUUID(),
  brdController.exportDOCX
);

/**
 * GET /api/brd/:id/export-text
 * Export BRD to plain text
 */
router.get(
  '/:id/export-text',
  param('id').isUUID(),
  brdController.exportText
);

/**
 * POST /api/brd/:id/export-excel
 * Export BRD to Excel
 */
router.post(
  '/:id/export-excel',
  param('id').isUUID(),
  brdController.exportExcel
);

/**
 * GET /api/brd/:id/analyze
 * Analyze BRD content using AI
 */
router.get(
  '/:id/analyze',
  param('id').isString(),
  brdController.analyzeBRD
);

/**
 * GET /api/brd/:id/estimate
 * Estimate project effort using AI
 */
router.get(
  '/:id/estimate',
  authMiddleware,
  param('id').isString(),
  brdController.estimateBRD
);

/**
 * POST /api/brd/:id/convert-to-stories
 * Extract user stories from BRD using AI
 */
router.post(
  '/:id/convert-to-stories',
  param('id').isUUID(),
  brdController.convertToStories
);

/**
 * GET /api/brd/:id/versions/:versionNumber
 * Get specific version content
 */
router.get(
  '/:id/versions/:versionNumber',
  [
    param('id').isString(),
    param('versionNumber').isInt()
  ],
  brdController.getVersionContent
);

/**
 * WORKFLOW ROUTES
 */

/**
 * POST /api/brd/:id/request-review
 * Request review for BRD (draft â†’ in-review)
 */
router.post(
  '/:id/request-review',
  param('id').isUUID(),
  body('assigned_to').isInt().withMessage('Reviewer ID must be an integer'),
  body('reason').optional().isString(),
  brdController.requestReview
);

/**
 * POST /api/brd/:id/approve
 * Approve BRD (in-review â†’ approved)
 */
router.post(
  '/:id/approve',
  param('id').isUUID(),
  body('reason').optional().isString(),
  brdController.approveBRD
);

/**
 * POST /api/brd/:id/reassign
 * Re-assign BRD review (in-review -> in-review)
 */
router.post(
  '/:id/reassign',
  param('id').isUUID(),
  body('assigned_to').isInt().withMessage('New reviewer ID must be an integer'),
  body('reason').optional().isString(),
  brdController.reassignBRD
);

/**
 * POST /api/brd/:id/reject
 * Reject BRD for revisions (in-review â†’ draft)
 */
router.post(
  '/:id/reject',
  param('id').isUUID(),
  body('reason').optional().isString(),
  brdController.rejectBRD
);

/**
 * GET /api/brd/:id/workflow-history
 * Get workflow history
 */
router.get(
  '/:id/workflow-history',
  param('id').isUUID(),
  brdController.getWorkflowHistory
);

/**
 * GET /api/brd/:id/review-assignments
 * Get review assignments
 */
router.get(
  '/:id/review-assignments',
  param('id').isUUID(),
  brdController.getReviewAssignments
);

/**
 * POST /api/brd/:id/collaborators
 * Add collaborator to BRD
 */
router.post(
  '/:id/collaborators',
  param('id').isUUID(),
  body('user_id').isInt().withMessage('User ID must be an integer'),
  body('permission_level').optional().isIn(['view', 'comment', 'edit']),
  brdController.addCollaborator
);

/**
 * DELETE /api/brd/:id/collaborators/:collaboratorId
 * Remove collaborator from BRD
 */
router.delete(
  '/:id/collaborators/:collaboratorId',
  param('id').isUUID(),
  param('collaboratorId').isInt(),
  brdController.removeCollaborator
);

/**
 * GET /api/brd/:id/collaborators
 * Get collaborators for BRD
 */
router.get(
  '/:id/collaborators',
  param('id').isUUID(),
  brdController.getCollaborators
);

/**
 * GET /api/brd/:id/activity-log
 * Get activity log for BRD
 */
router.get(
  '/:id/activity-log',
  param('id').isUUID(),
  brdController.getActivityLog
);

/**
 * GET /api/brd/:id/comments
 * Get comments for BRD
 */
router.get(
  '/:id/comments',
  param('id').isUUID(),
  brdController.getComments
);

/**
 * POST /api/brd/:id/comments
 * Add comment to BRD
 */
router.post(
  '/:id/comments',
  param('id').isUUID(),
  body('section_id').notEmpty().withMessage('Section ID is required'),
  body('comment_text').trim().notEmpty().withMessage('Comment text is required'),
  brdController.addComment
);

/**
 * PUT /api/brd/:id/comments/:commentId
 * Update comment
 */
router.put(
  '/:id/comments/:commentId',
  param('id').isUUID(),
  param('commentId').isInt(),
  body('comment_text').optional().trim(),
  body('is_resolved').optional().isBoolean(),
  brdController.updateComment
);

/**
 * DELETE /api/brd/:id/comments/:commentId
 * Delete comment
 */
router.delete(
  '/:id/comments/:commentId',
  param('id').isUUID(),
  param('commentId').isInt(),
  brdController.deleteComment
);

/**
 * POST /api/brd/smart-edit
 * Smart edit text with AI
 */
router.post(
  '/smart-edit',
  body('selection').notEmpty().withMessage('Selection is required'),
  body('instruction').notEmpty().withMessage('Instruction is required'),
  brdController.smartEdit
);

/**
 * GET /api/brd/:id/review-assignments
 * Get review assignments for a BRD
 */
router.get(
  '/:id/review-assignments',
  param('id').isUUID(),
  brdController.getReviewAssignments
);

/**
 * POST /api/brd/:id/review-assignments
 * Assign reviewers to a BRD
 */
router.post(
  '/:id/review-assignments',
  param('id').isUUID(),
  body('reviewer_ids').isArray({ min: 1 }).withMessage('At least one reviewer is required'),
  brdController.assignReviewers
);

/**
 * PUT /api/brd/:id/review-assignments/:assignmentId
 * Update review assignment status
 */
router.put(
  '/:id/review-assignments/:assignmentId',
  param('id').isUUID(),
  param('assignmentId').isInt(),
  body('status').isIn(['pending', 'approved', 'rejected']),
  brdController.updateReviewAssignment
);

/**
 * GET /api/brd/:id/workflow-history
 * Get workflow history for a BRD
 */
router.get(
  '/:id/workflow-history',
  param('id').isUUID(),
  brdController.getWorkflowHistory
);

module.exports = router;
